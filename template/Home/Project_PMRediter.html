<include file="Public:head"/>
<style>
input { width:130PX;}
select{ width:137PX;}
TABLE TD{ padding-left:5PX; padding-top:5PX; padding-right:5PX; color:#666666}
.s-table caption{ height:40PX; line-height:40PX; background-color:#f5f5f5;border-top: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC; margin-top:20PX; font-size:14px; font-weight:bold}
</style>
<!-- BEGIN PAGE LEVEL STYLES --> 
	<link href="__ROOT__/public/media/css/jquery.gritter.css" rel="stylesheet" type="text/css"/>
	<link href="__ROOT__/public/media/css/daterangepicker.css" rel="stylesheet" type="text/css" />
	<link href="__ROOT__/public/media/css/fullcalendar.css" rel="stylesheet" type="text/css"/>
	<link href="__ROOT__/public/media/css/jqvmap.css" rel="stylesheet" type="text/css" media="screen"/>
	<link href="__ROOT__/public/media/css/jquery.easy-pie-chart.css" rel="stylesheet" type="text/css" media="screen"/>
<!-- END PAGE LEVEL STYLES -->
		<!-- BEGIN PAGE -->
<div class="page-content" style="min-height:560px;">
	<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
	<div id="portlet-config" class="modal hide">
		<div class="modal-header">
			<button data-dismiss="modal" class="close" type="button"></button>
			<h3>Widget Settings</h3>
		</div>
		<div class="modal-body">
			Widget settings form goes here
		</div>
	</div>
	<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
	<!-- BEGIN PAGE CONTAINER-->
	<div class="container-fluid">
		<!-- BEGIN PAGE HEADER-->
		<include file="Public:welcome"/>
		<ul class="breadcrumb">

							<li>

								<i class="icon-home"></i>

								<a href="{:U('Index/Agent')}">平台首页</a> 

								<span class="icon-angle-right"></span>

							</li>

							<li>

								<a href="{:U('Project/PList')}">项目列表</a>

								<span class="icon-angle-right"></span>

							</li>

							
                            <li><a>查看月报</a></li>
						</ul>
		<!-- END PAGE HEADER-->
		<div class="portlet box blue tabbable">

							<div class="portlet-title">

								<div class="caption">

									<i class="icon-reorder"></i>

									<span class="hidden-480">修改月报</span>

								</div>

							</div>

							<div class="portlet-body form">

								<div class="tabbable portlet-tabs">

									<ul class="nav nav-tabs">
										<li class=""><a href="#portlet_tab3" data-toggle="tab"></a></li>

										<li class=""><a href="#portlet_tab2" data-toggle="tab"></a></li>

										<li class="active"><a href="#portlet_tab1" data-toggle="tab"></a></li>
									</ul>

									<div class="tab-content">
<BR />

<form action="__APP__/Project/editemonthpreport" method="post" accept-charset="utf-8">

        <div>
            <table id="addNode" class="s-table" width="100%" border="1" cellspacing="1" bordercolor="#CCCCCC" cellpadding="0">
                <caption>建设时序计划完成情况<span class="required">*</span></caption>
                <tr>
                    <td>节点</td>
                    <td>完成拆迁</td>
                    <td>开始打桩</td>
                    <td>基础开挖</td>
                    <td>正&nbsp;负&nbsp;零</td>
                    <td>主体封顶</td>
                    <td>主体竣工</td>
                    <td>设备安装调试(装修)</td>
                    <td>部分投产(营业)</td>
                    <td colspan="2">全部投产(营业)</td>
                </tr>
                <tr>
                    <td>计划</td>
                    <td>{$projecteditemr.build_plan_demolition}<input name="build_plan_demolition" type="hidden" value="{$projecteditemr.build_plan_demolition}" /></td>
                    <td>{$projecteditemr.build_plan_piling}<input name="build_plan_piling" type="hidden" value="{$projecteditemr.build_plan_piling}" /></td>
                    <td>{$projecteditemr.build_plan_excavate}<input name="build_plan_excavate" type="hidden" value="{$projecteditemr.build_plan_excavate}" /></td>
                    <td>{$projecteditemr.build_plan_pmz}<input name="build_plan_pmz" type="hidden" value="{$projecteditemr.build_plan_pmz}" /></td>
                    <td>{$projecteditemr.build_plan_cap}<input name="build_plan_cap" type="hidden" value="{$projecteditemr.build_plan_cap}" /></td>
                    <td>{$projecteditemr.build_plan_completion}<input name="build_plan_completion" type="hidden" value="{$projecteditemr.build_plan_completion}" /></td>
                    <td>{$projecteditemr.build_plan_device}<input name="build_plan_device" type="hidden" value="{$projecteditemr.build_plan_device}" /></td>
                    <td>{$projecteditemr.build_plan_partproduction}<input name="build_plan_partproduction" type="hidden" value="{$projecteditemr.build_plan_partproduction}" /></td>
                    <td colspan="2">{$projecteditemr.build_plan_allproduction}<input name="build_plan_allproduction" type="hidden" value="{$projecteditemr.build_plan_allproduction}" /></td>
                </tr>
                <tr>
                		<td>实际</td>
                		<td><input type="text" style="width:87%" class="normal datepicker"  value="{$projecteditemr.build_actual_demolition}" name="build_actual_demolition"></td>
                		<td><input type="text" style="width:87%" class="normal datepicker"  value="{$projecteditemr.build_actual_piling}" name="build_actual_piling"></td>
                		<td><input type="text" style="width:87%" class="normal datepicker"  value="{$projecteditemr.build_actual_excavate}" name="build_actual_excavate"></td>
                		<td><input type="text" style="width:87%" class="normal datepicker"  value="{$projecteditemr.build_actual_pmz}" name="build_actual_pmz"></td>
                		<td><input type="text" style="width:87%" class="normal datepicker"  value="{$projecteditemr.build_actual_cap}" name="build_actual_cap"></td>
                		<td><input type="text" style="width:87%" class="normal datepicker"  value="{$projecteditemr.build_actual_completion}" name="build_actual_completion"></td>
                		<td><input type="text" style="width:87%" class="normal datepicker"  value="{$projecteditemr.build_actual_device}" name="build_actual_device"></td>
                		<td><input type="text" style="width:87%" class="normal datepicker"  value="{$projecteditemr.build_actual_partproduction}" name="build_actual_partproduction"></td>
                		<td colspan="2"><input type="text" style="width:87%" class="normal datepicker"  value="{$projecteditemr.build_actual_allproduction}" name="build_actual_allproduction"></td>
                </tr>
            </table>
          <!--  <button id="addNodeButtom" type="button" class="btn green" style="margin-top: 10px;">添加节点</button> -->
        </div>
		<div>
		<table class="s-table" border="1" cellspacing="1" bordercolor="#CCCCCC" cellpadding="0" width="100%">
                <caption>详细进展</caption>
                <tr>
                    <td height="59" colspan="6" align="center"><label>
                    		<textarea name="content_jinzhan" id="content_jinzhan" cols="45" rows="5" style="width:96%">{$projecteditemr.content_jinzhan}</textarea>
                    </label></td>
                    </tr>
            </table>
			</div>
 <div>
            <table class="s-table" border="1" cellspacing="1" bordercolor="#CCCCCC" cellpadding="0" width="100%">
                <caption>存在问题</caption>
                <tr>
                    <td height="59" colspan="6" align="center"><label>
                    		<textarea name="content_problem" id="content_problem" cols="45" rows="5" style="width:96%">{$projecteditemr.content_problem}</textarea>
                    </label></td>
                    </tr>
            </table>
        </div>
		<div>
            <table class="s-table" border="1" cellspacing="1" bordercolor="#CCCCCC" cellpadding="0" width="100%">
                <caption>市领导挂钩情况</caption>
                <tr>
                    <td height="59" colspan="6" align="center"><label>
                    		<textarea name="content_leader" id="content_leader" cols="45" rows="5" style="width:96%">{$projecteditemr.content_leader}</textarea>
                    </label></td>
                    </tr>
            </table>
        </div>
												<div class="form-actions">

													<button type="submit" class="btn blue"><i class="icon-ok"></i> 保存</button>

													<button type="button" class="btn">取消</button>

												</div>
<input name="id" type="hidden" value="{$projecteditemr.id}" />

</form>
<div class="row-fluid"><div class="span6"><div class="dataTables_info" id="sample_editable_1_info"></div></div><div class="span6"><div class="dataTables_paginate paging_bootstrap pagination"><ul>{$page_pro}</ul></div></div></div></div>
									</div>

								</div>

							</div>

						</div>

	</div>
	<!-- END PAGE CONTAINER-->    
</div>
<!-- END PAGE -->
<include file="Public:footer"/>

<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="__ROOT__/public/media/js/jquery.vmap.js" type="text/javascript"></script>   
<script src="__ROOT__/public/media/js/jquery.vmap.russia.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/jquery.vmap.world.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/jquery.vmap.europe.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/jquery.vmap.germany.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/jquery.vmap.usa.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/jquery.vmap.sampledata.js" type="text/javascript"></script>  
<script src="__ROOT__/public/media/js/jquery.flot.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/jquery.flot.resize.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/jquery.pulsate.min.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/date.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/daterangepicker.js" type="text/javascript"></script>     
<script src="__ROOT__/public/media/js/jquery.gritter.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/fullcalendar.min.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/jquery.easy-pie-chart.js" type="text/javascript"></script>
<script src="__ROOT__/public/media/js/jquery.sparkline.min.js" type="text/javascript"></script>  
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="__ROOT__/public/media/js/app.js" type="text/javascript"></script>
<!-- END PAGE LEVEL SCRIPTS -->  
<!-- END JAVASCRIPTS -->
<script>
var Index = function () {
return {
	//main function to initiate the module
	init: function () {
		App.addResponsiveHandler(function () {
			Index.initCalendar();
			jQuery('.vmaps').each(function () {
				var map = jQuery(this);
				map.width(map.parent().width());
			});
		});
	},

initCharts: function () {
	if (!jQuery.plot) {
		return;
	}
	
function showTooltip(title, x, y, contents) {
	$('<div id="tooltip" class="chart-tooltip"><div class="date">' + title + '<\/div><div class="label label-success">CTR: ' + x + '<\/div><div class="label label-important">Imp: ' + y + '<\/div><\/div>').css({
		position: 'absolute',
		display: 'none',
		top: y - 100,
		width: 75,
		left: x - 40,
		border: '0px solid #ccc',
		padding: '2px 6px',
		'background-color': '#fff',
	}).appendTo("body").fadeIn(200);
}

<php>$i=0;$j=0;$m=0;</php>
var pageviews = [
<foreach name="chartmemberlist" item="v" key="k">
	[{$i}, {$v}]<if condition="$i neq '29' ">,</if>
<php>$i++;</php>
</foreach>
];

var visitors = [
<foreach name="chartorderlist" item="v" key="k">
	[{$j}, {$v}]<if condition="$j neq '29' ">,</if>
<php>$j++;</php>
</foreach>
];
			
            if ($('#site_statistics').size() != 0) {
                $('#site_statistics_loading').hide();
                $('#site_statistics_content').show();
                var plot_statistics = $.plot($("#site_statistics"), [{
                        data: pageviews,
                        label: "净增会员数"
                    }, {
                        data: visitors,
                        label: "净增订单数"
                    }
                ], {
                    series: {
                        lines: {
                            show: true,
                            lineWidth: 2,
                            fill: true,
                            fillColor: {
                                colors: [{
                                        opacity: 0.05
                                    }, {
                                        opacity: 0.01
                                    }
                                ]
                            }
                        },
                        points: {
                            show: true
                        },
                        shadowSize: 2
                    },
                    grid: {
                        hoverable: true,
                        clickable: true,
                        tickColor: "#eee",
                        borderWidth: 0
                    },
                    colors: ["#d12610", "#37b7f3", "#52e136"],
					xaxis: {
                        ticks: [
						
					<foreach name="chartorderlist" item="v" key="k">				
						[{$m}, "{$k}"]<if condition="$i neq '29' ">,</if>
					<php>$m++;</php>	
					</foreach>	
						
						
						],
                        tickDecimals: 0
                    },
                    yaxis: {
                        ticks: 11,
                        tickDecimals: 0
                    }
                });

                var previousPoint = null;
                $("#site_statistics").bind("plothover", function (event, pos, item) {
                    $("#x").text(pos.x.toFixed(2));
                    $("#y").text(pos.y.toFixed(2));
                    if (item) {
                        if (previousPoint != item.dataIndex) {
                            previousPoint = item.dataIndex;

                            $("#tooltip").remove();
                            var x = item.datapoint[0].toFixed(2),
                                y = item.datapoint[1].toFixed(2);

                           // showTooltip(item.series.label,item.pageX , item.pageY, item.series.label + " of " + x + " = " + y);
                        }
                    } else {
                        $("#tooltip").remove();
                        previousPoint = null;
                    }
                });
            }
        },
		
    };

}();

jQuery(document).ready(function(){   
	   App.init(); // initlayout and core plugins
	   Index.initCharts(); // init index page's custom scripts
});
</script>
<!-- END BODY -->
<script type="text/javascript">
    var counttr = 0;
    $(function() {

//        延迟绑定datepicker
        $("body").delegate(".datepicker", "focusin", function(){
            $(this).datepicker({
                dateFormat: "yy-mm-dd",
                changeMonth: true,
                changeYear: true
            });
        });
        $('select[name="base[responsibility]"]').change(function(){
            $code =  $("input[name='base[projectcoding]']").val().replace(/[a-zA-Z]+/,'');
            $("input[name='base[projectcoding]']").val($(this).val() + $code ) ;
            $("input[name='base[projectcoding]']").siblings('span').html($(this).val() + $code);
        });
        $('#addNodeButtom').click(function(){
            counttr++;
            var node = '<tr>' +
                            '<td><input type="hidden" style="width:87%"  name="build[' + counttr+ '][name]">计划<\/td>' +
                            '<td><input type="text" style="width:87%" name="build[' + counttr+ '][build_plan_demolition]"><\/td>' +
                            '<td><input type="text" style="width:87%" name="build[' + counttr+ '][build_plan_piling]"><\/td>' +
                            '<td><input type="text" style="width:87%" name="build[' + counttr+ '][build_plan_excavate]"><\/td>' +
                            '<td><input type="text" style="width:87%" name="build[' + counttr+ '][build_plan_pmz]"><\/td>' +
                            '<td><input type="text" style="width:87%" name="build[' + counttr+ '][build_plan_cap]"><\/td>' +
                            '<td><input type="text" style="width:87%" name="build[' + counttr+ '][build_plan_completion]"><\/td>' +
                            '<td><input type="text" style="width:87%" name="build[' + counttr+ '][build_plan_device]"><\/td>' +
                            '<td><input type="text" style="width:87%" name="build[' + counttr+ '][build_plan_partproduction]"><\/td>' +
                            '<td width="100px"><input type="text" style="width:87%" name="build[' + counttr+ '][build_plan_allproduction]"><\/td>' +
                            '<td width="10px;"><span class="deleteNode">X<\/span><\/td> ' +
                        ' <\/tr>';
            $('#addNode').append(node);
        });

        $('#addNode').on('click','.deleteNode', function(){
            if(confirm('确定删除')){
                $(this).parent().parent().remove();
            }
        });


        $('#createproject').submit(function(){
            if($('select[name="base[responsibility]"]').val() == ''){
                alert('请选择责任主体');
                return false;
            }

            $('input[type=submit]').attr({disabled:"disabled",value:'loading..'});
            $.post(
                $(this).attr("action"),
                $(this).serialize(),
                function(data){
                    if( data == '')
                        location.href = '/project/list/';

                    $('#error').html(data);
                    $('input[type=submit]').attr({value:'提交'}).removeAttr('disabled');
                }
            );

            return false;
        });

    });
</script>
</body>
</html>